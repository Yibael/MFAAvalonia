# MFAAvalonia 完整使用指南

## 🎯 项目简介

**MFAAvalonia** 是一个基于 Avalonia UI 框架的 MAAFramework 通用图形界面项目。它提供了一个现代化的跨平台桌面应用程序，用于运行基于 MAAFramework 的自动化任务。

### 主要特性
- 🖥️ **跨平台支持** - Windows、Linux、macOS
- 🎨 **现代化界面** - 基于 Avalonia UI 和 SukiUI
- 🔧 **高度可配置** - 通过 JSON 配置文件自定义
- 🚀 **自动化构建** - GitHub Actions 支持
- 🌐 **多语言支持** - 支持中文、英文等多种语言

## 📋 系统需求

### 运行环境
- **.NET 8.0 运行时** （必需）
- **操作系统**: Windows 10+, macOS 10.15+, 或现代 Linux 发行版
- **内存**: 至少 512MB RAM
- **存储**: 至少 100MB 可用空间

### 开发环境（如果要修改代码）
- **.NET 8.0 SDK**
- **Visual Studio 2022** 或 **JetBrains Rider** 或 **VS Code**

## 🚀 快速开始

### 方式一：下载预构建版本（推荐新手）

1. **访问 Releases 页面**
   ```
   https://github.com/Yibael/MFAAvalonia/releases
   ```

2. **下载适合你系统的版本**
   - Windows: `MFAAvalonia-win-x64.zip`
   - macOS: `MFAAvalonia-osx-x64.zip` 或 `MFAAvalonia-osx-arm64.zip`
   - Linux: `MFAAvalonia-linux-x64.zip`

3. **解压并运行**
   ```bash
   # Windows
   # 双击 MFAAvalonia.exe 或运行 start.bat
   
   # macOS/Linux
   chmod +x MFAAvalonia
   ./MFAAvalonia
   # 或运行 ./start.sh
   ```

### 方式二：使用 GitHub Actions 自动构建

#### 📝 准备工作

1. **Fork 这个仓库** 到你的 GitHub 账户
2. **克隆到本地**
   ```bash
   git clone https://github.com/你的用户名/MFAAvalonia.git
   cd MFAAvalonia
   ```

#### 🔧 配置 GitHub Actions

##### 步骤 1: 修改 install.yml

打开 `.github/workflows/install.yml` 文件，修改以下内容：

```yaml
# 找到第 75 行左右，修改仓库信息
- name: Download MFAAvalonia
  uses: robinraju/release-downloader@v1
  with:
    repository: 你的用户名/你的项目名  # ← 修改这里
    fileName: "MFAAvalonia-*-..."
    # ... 其他配置保持不变
```

```yaml
# 找到第 116 行左右，修改构建产物名称  
- uses: actions/upload-artifact@v4
  with:
    name: 你的项目名-${{ matrix.os }}-${{ matrix.arch }}  # ← 修改这里
    path: "install"
```

##### 步骤 2: 配置权限

1. 进入你的 GitHub 仓库设置
2. 点击 **Settings** → **Actions** → **General**
3. 在 **Workflow permissions** 部分选择：
   - ✅ **Read and write permissions**
   - ✅ **Allow GitHub Actions to create and approve pull requests**

##### 步骤 3: 触发构建

```bash
# 提交更改
git add .
git commit -m "配置 GitHub Actions"
git push origin main

# 创建版本标签来触发正式构建
git tag v1.0.0
git push origin v1.0.0
```

## 📁 项目配置

### interface.json 配置文件

这是 MFAAvalonia 的核心配置文件，定义了资源路径和任务：

```json
{
  "name": "我的MAA项目",
  "version": "1.0.0", 
  "url": "https://github.com/你的用户名/你的项目",
  "custom_title": "我的MAA项目",
  "mirrorchyan_rid": "M9A",  // Mirror酱项目ID（可选）
  "resource": [
    {
      "name": "官服",
      "path": "{PROJECT_DIR}/resource/base"
    },
    {
      "name": "B服", 
      "path": [
        "{PROJECT_DIR}/resource/base",
        "{PROJECT_DIR}/resource/bilibili"
      ]
    }
  ],
  "task": [
    {
      "name": "日常任务",
      "entry": "DailyTask",
      "check": true,          // 默认选中
      "doc": "执行日常刷图任务",
      "repeatable": true,     // 可重复执行
      "repeat_count": 1       // 默认重复次数
    },
    {
      "name": "活动任务", 
      "entry": "EventTask",
      "check": false,
      "doc": "[color:blue]限时活动任务[/color]"
    }
  ]
}
```

### 🎨 文档格式化

在 `doc` 字段中可以使用富文本格式：

```json
{
  "doc": "[color:red]重要提示[/color]\n[b]粗体文字[/b]\n[i]斜体文字[/i]\n[u]下划线[/u]"
}
```

支持的标记：
- `[color:red]文字[/color]` - 颜色
- `[b]文字[/b]` - 粗体
- `[i]文字[/i]` - 斜体  
- `[u]文字[/u]` - 下划线
- `[s]文字[/s]` - 删除线
- `[align:center]文字[/align]` - 对齐方式

### 🌐 多语言支持

创建 `lang` 文件夹，添加语言文件：

```
lang/
├── zh-cn.json  // 简体中文
├── zh-tw.json  // 繁体中文  
└── en-us.json  // 英文
```

**zh-cn.json 示例：**
```json
{
  "DailyTask": "日常任务",
  "EventTask": "活动任务",
  "task_description": "这是任务描述"
}
```

然后在 `interface.json` 中使用键名：
```json
{
  "task": [
    {
      "name": "DailyTask",  // 将自动根据语言显示对应翻译
      "entry": "DailyTask",
      "doc": "task_description"
    }
  ]
}
```

## 🔧 高级配置

### 实验性功能：Advanced 字段

允许用户通过界面输入框自定义参数：

```json
{
  "task": [
    {
      "name": "自定义任务",
      "entry": "CustomTask", 
      "advanced": ["设置A", "设置B"]
    }
  ],
  "advanced": {
    "设置A": {
      "field": "image_name",
      "type": "string", 
      "default": "target.png",
      "pipeline_override": {
        "CustomTask": {
          "template": "{image_name}"
        }
      }
    },
    "设置B": {
      "field": ["x", "y"],
      "type": ["int", "int"],
      "default": ["100", "200"],
      "pipeline_override": {
        "CustomTask": {
          "roi": ["{x}", "{y}", 50, 50]
        }
      }
    }
  }
}
```

## 🛠️ 开发和调试

### 本地开发环境

1. **克隆项目**
   ```bash
   git clone https://github.com/Yibael/MFAAvalonia.git
   cd MFAAvalonia
   ```

2. **安装依赖**
   ```bash
   dotnet restore
   ```

3. **运行项目**
   ```bash
   dotnet run --project MFAAvalonia
   ```

### 调试配置

可以通过命令行参数指定配置文件：
```bash
# 使用自定义配置
./MFAAvalonia -c my_config

# 这会加载 my_config.json 而不是默认的 interface.json
```

## ❗ 常见问题

### Q: GitHub Actions 构建失败怎么办？

**A:** 检查以下几点：
1. 确认修改了正确的仓库名称
2. 检查 Actions 权限设置
3. 查看构建日志中的具体错误信息
4. 确保 `install.py` 脚本存在且可执行

### Q: 程序启动时提示缺少 .NET 运行时？

**A:** 
```bash
# Windows (使用 winget)
winget install Microsoft.DotNet.Runtime.8

# macOS (使用 Homebrew)
brew install --cask dotnet

# Linux (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y dotnet-runtime-8.0
```

### Q: 如何添加自己的 MAA 资源？

**A:**
1. 将 MAA 项目的 `assets/resource` 内容复制到 `resource/` 目录
2. 将 `assets/interface.json` 复制到根目录
3. 根据上面的说明修改 `interface.json`

### Q: 如何自定义程序图标和名称？

**A:**
1. 修改 `interface.json` 中的 `name` 和 `custom_title` 字段
2. 替换 `Assets/logo.ico` 文件
3. 重新构建项目

### Q: 支持哪些 MAA 版本？

**A:** 支持基于 **MaaFramework** 的项目，版本兼容性：
- MaaFramework v1.0.0+
- MFAAvalonia v1.1.6+ 移除了旧的 focus 字段，使用新的 any focus 格式

## 🔗 相关链接

- **项目主页**: https://github.com/Yibael/MFAAvalonia
- **MaaFramework**: https://github.com/MaaXYZ/MaaFramework  
- **Avalonia UI**: https://github.com/AvaloniaUI/Avalonia
- **SukiUI**: https://github.com/kikipoulet/SukiUI
- **Mirror酱**: https://mirrorchyan.com/

## 📝 许可证

本项目采用 **GPL-3.0** 许可证开源。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

1. Fork 项目
2. 创建特性分支: `git checkout -b my-new-feature`  
3. 提交更改: `git commit -am 'Add some feature'`
4. 推送分支: `git push origin my-new-feature`
5. 提交 Pull Request

---

*最后更新: 2025年9月23日*